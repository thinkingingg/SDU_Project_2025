# # 隐私保护集合交集求和协议实验

## 1. 实验概述<u></u>

本实验实现了一个基于判定性迪菲-赫尔曼问题(DDH)的隐私保护集合交集求和协议，允许协议双方在不泄露各自原始数据的情况下，安全计算出双方数据集交集中元素的关联值之和。实验结果显示，对于测试数据集["张三","李四","王五"]和[("李四",25),("赵六",20),("张三",50)]，成功计算出交集元素关联值总和为75。

## 2. 技术原理<u></u>

### 协议数学基础

**安全假设**：判定性迪菲-赫尔曼问题(DDH)在素数阶群中的困难性

给定乘法群G = (ℤₚ*, ×)：

- 大素数 p = 2q + 1（q为素数）
- 生成元 g ∈ G 的阶为q

对于随机选择的a,b ∈ ℤₚ*，三元组(gᵃ, gᵇ, gᵃᵇ)与(gᵃ, gᵇ, gᶜ)（c随机）计算不可区分

### 协议流程

**参与方**：

- P1：持有集合 V = {v₁,...,vₙ}
- P2：持有键值对 W = {(w₁,t₁),...,(wₘ,tₘ)}

**协议步骤**：

1. **Setup**：
   
   - P1选择私钥 k₁ ←$ ℤₚ*
   - P2选择私钥 k₂ ←$ ℤₚ*，生成Paillier密钥对(pk,sk)

2. **Round 1 (P1→P2)**：
   
   - P1发送：{H(vᵢ)ᵏ¹ mod p | vᵢ ∈ V} (乱序)

3. **Round 2 (P2→P1)**：
   
   - P2发送：
     - Z = {H(vᵢ)ᵏ¹ᵏ² mod p}
     - {(H(wⱼ)ᵏ² mod p, Enc(tⱼ)) | (wⱼ,tⱼ) ∈ W} (乱序)

4. **Round 3 (P1→P2)**：
   
   - P1计算交集和：
     - 对于每个(H(wⱼ)ᵏ², Enc(tⱼ))，检查H(wⱼ)ᵏ²ᵏ¹ ∈ Z
     - 对交集元素的加密值求和：Enc(∑tⱼ)
   - 发送随机化后的加密和

5. **Output**：
   
   - P2解密得到最终结果

### 关键算法

**哈希到群**：

 H(v) = (SHA3-256(v)² mod p) ∈ QRₚ

**安全性保证**：

- 语义安全：基于DDH假设和Paillier加密
- 隐私保护：各方仅获知交集和，不泄露其他信息

## 3. 实验思路<u></u>

1. **密码学原语选择**：
   
   - 使用1024位安全素数构造乘法群
   - 采用SHA3-256作为哈希函数
   - Paillier加密实现同态求和

2. **协议实现**：
   
   - 分阶段实现三轮协议通信
   - 通过随机排列实现数据混淆

3. **正确性验证**：
   
   - 构造已知交集的数据集
   - 验证计算结果与预期一致

## 4. 代码概述<u></u>

### 主要结构

* ProtocolInitiator: 协议发起方实现
  
  * first_phase(): 执行第一轮计算
  
  * third_phase(): 计算交集和

* ProtocolResponder: 协议响应方实现
  
  * second_phase(): 执行第二轮计算
  
  * decrypt_result(): 解密最终结果

### 关键函数

```python
def hash_to_group(element): 
    # 将元素映射到二次剩余子群
    return pow(sha3_256(element).digest(), 2, p)

def third_phase(received_pairs, verification_set): # 同态计算交集和 
    for point, cipher in received_pairs: 
        if pow(point, k1, p) in verification_set: 
            sum_cipher += cipher
```

## 5. 环境配置与运行<u></u>

### 依赖安装

```bash
pip install phe hashlib
```

### 运行命令

```bash
python DDH.py
```

## 6. 结果分析与结论<u></u>

### 结果分析

1. **正确性验证**：
   
   * 输入：P1["张三","李四","王五"], P2[("李四",25),("赵六",20),("张三",50)]
   
   * 计算交集：{"张三","李四"}
   
   * 正确求和：50 + 25 = 75

2. **安全性验证**：
   
   * 协议执行过程中未暴露原始数据
   
   * 中间传输数据均为随机化处理结果

### 实验结论

1. 成功实现了基于DDH的安全多方计算协议

2. 协议满足以下安全特性：
   
   * 输入隐私性：各方无法获取对方非交集元素
   
   * 正确性：计算结果与明文计算一致

3. 验证了在半诚实模型下的安全性

4. 该协议可应用于隐私保护的联合数据分析场景

----
